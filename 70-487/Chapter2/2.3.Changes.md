# Chapter 2

Changes and additions to 70-486

## Part 1

Query/Manipulate data with EF

### Async operations in EF

You can use the `context.SaveChangesAsync()` to asynchronously save changes.

You can use an await in a linq statement:

```
var blogs = await (from b in db.Blogs
                    orderby b.Name
                    select b).ToListAsync()

```

This must happen in an `async` method.

### Mapping stored procs

You can map stored procedures via the entity designer.

Use the **mapping details** > **select insert function**

You can use this to map entity types to the stores proc.


## Part 2

Query & manipulate data using data provider for E.F.

### Configure a DataProvider in Code

Only for EF v.6 onwards, you can configure the data provider in code with `System.Data.Entity.Config.DbConfiguration`. It is recommended to only build one `DbConfiguration` class and to place it in the same assembly as the `DbContext` class.

The `DbConfiguration` should have a public, parameterless constructor and config options should be set by calling methods within the constructor. For example:

```
using System.Data.Entity;
using System.Data.Entity.Infrastructure;
using System.Data.Entity.SqlServer;

namespace MyNamespace
{
    public class MyConfiguration : DbConfiguration
    {
        public MyConfiguration()
        {
            SetExecutionStrategy("System.Data.SqlClient", () => new SqlAzureExecutionStrategy());
            SetDefaultConnectionFactory(new LocalDbConnectionFactory("v11.0"));
        }
    }
}
```

Alternatively you can set the config on a context class per:

```
[DbConfigurationType(typeof(MyDbConfiguration))]
public class MyContextContext : DbContext {}
```
or

```
[DbConfigurationType("MyNamespace.MyDbConfiguration, MyAssembly")]
public class MyContextContext : DbContext {}
```